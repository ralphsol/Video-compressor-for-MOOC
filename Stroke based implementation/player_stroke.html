<html>
<body>
    <div hidden><img id="xournal" src="bg.png" width="500" height="400"></div>
<canvas id="myCanvas" width="612" height="792"
style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>
<input type="file" name="file" id="file"/>
<button onclick="play()">Play/Pause</button>
<script>
	var strokeArr = [];
    var dataArr=[];
    var timeArr=[];
    var time=0;    
	document.getElementById('file').onchange = function(){    
		var file = this.files[0];
		var reader = new FileReader();
		reader.onload = function(progressEvent){
			// Entire file
			console.log(this.result);
			// By lines
			var end=1;
			var lines = this.result.split('\n');
			for(var line = 0; line < lines.length; line++){
				var words = lines[line].split(' ');
				if(words[0].localeCompare("<stroke>")==0)
				{
					//alert("in-here");
					var dataVal = lines[line+1].split(' ');
					for(var i = 0 ; i < dataVal.length ; i++) {
						if(i%3 == 2) {
							if(dataVal[i].localeCompare("NaN")!=0)
								timeArr.push(parseFloat(dataVal[i]));
						}
						else {
							if(dataVal[i].localeCompare("NaN")!=0)
								dataArr.push(parseInt(dataVal[i]));
						}
					}
				}
				else if(words[0].localeCompare("</stroke>")==0) {
					strokeArr.push(dataArr);
					dataArr = [];
					//alert(strokeArr.length);
					//alert(strokeArr.join("\n"));
				}
				console.log(lines[line]);
			}
			//alert(strokeArr.length);
		};
		reader.readAsText(file);
		//alert(strokeArr.length);
		//alert(dataArr.length);
		//alert(dataArr.join("\n"));
		//alert(timeArr.join("\n"));
	};
	
	function play() {
		var element = document.getElementById("myCanvas");
		var c = element.getContext("2d");
		var width = element.width;
		var height = element.height;
		//var index=0;
		var i = 0;
		var j = 0;
		var img = document.getElementById("xournal");
		c.drawImage(img,0,0,612,792);
		setInterval(
			function(){
				c.beginPath();
				c.moveTo(Math.round(strokeArr[i][j+1]*792.0/596.0),Math.round(strokeArr[i][j])*612.0/471.0);
				c.lineTo(Math.round(strokeArr[i][j+3]*792.0/596.0),Math.round(strokeArr[i][j+2])*612.0/471.0);
				//c.moveTo(dataArr[index],dataArr[index+1]);
				//c.lineTo(dataArr[index+2],dataArr[index+3]);
				c.stroke();
				j = j + 2;
				if(j > strokeArr[i].length) {
					j = 0;
					i = i + 1;
				}
			}
		,0.1);
	}
</script>
</body>
</html>